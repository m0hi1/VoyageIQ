import{j as e,B as w,Q as b,r as n,A as N,g as $,L as P,a as L,h as B,i as F,k as U}from"./index-007Z5DPj.js";const V="/assets/user-9m-8qGEi.png",z=({booking:s})=>{const{tourName:c,totalPrice:r,maxGroupSize:m,date:x,_id:i}=s,u=async()=>{window.confirm("Are you sure you want to delete this booking?")&&h()},h=async()=>{try{const t=await fetch(`${w}/booking/${i}`,{method:"DELETE"}),{message:d}=await t.json();t.ok?location.reload():b.error(d)}catch{b.error("Server not responding")}};return e.jsx(e.Fragment,{children:e.jsx("tbody",{className:"rounded overflow-hidden  py-8 px-3 bg-gray-100 shadow-lg",children:e.jsxs("tr",{className:"w-full text-center overflow-hidden",children:[e.jsx("td",{className:"tableData text-start",children:c}),e.jsx("td",{className:"hidden md:table-cell tableData",children:m}),e.jsx("td",{children:x}),e.jsxs("td",{children:["₹",r]}),e.jsxs("td",{children:[e.jsx("button",{onClick:u,className:"block md:hidden noCbtn bg-black my-2 mx-2 hover:bg-gray-900 ",children:"X"}),e.jsx("button",{onClick:u,className:"hidden md:block noCbtn bg-black my-2 mx-2 hover:bg-gray-900 ",children:"Cancel Booking"})]})]})})})},M=()=>{const{user:s}=n.useContext(N),{apiData:c}=$(`${w}/bookings`);return e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"flex flex-col gap-5",children:e.jsxs("table",{className:"w-full table-auto text-xs md:text-sm gap-4 border-collapse border",children:[e.jsx("thead",{className:"w-full py-2",children:e.jsxs("tr",{children:[e.jsx("th",{className:"tableData",children:"Tour"}),e.jsx("th",{className:"hidden md:block tableData",children:"Persons"}),e.jsx("th",{className:"tableData",children:"Booked for"}),e.jsx("th",{className:"tableData",children:"Price"}),e.jsx("th",{})]})}),c==null?void 0:c.map(r=>e.jsx(z,{booking:r},r._id))]})})})},H=({isOpen:s,onClose:c})=>{const{user:r,token:m,dispatch:x}=n.useContext(N),[i,u]=n.useState(!1),[h,t]=n.useState(null),[d,f]=n.useState(null),v=n.useRef(null),[a,k]=n.useState({username:"",email:"",currentPassword:"",newPassword:"",confirmPassword:""}),[p,A]=n.useState({}),[E,D]=n.useState(!1);n.useEffect(()=>{r&&(k(o=>({...o,username:r.username||"",email:r.email||""})),r.photo&&t(r.photo.startsWith("http")?r.photo:`${w}/${r.photo}`)),s&&setTimeout(()=>{D(!0)},10)},[r,s]);const y=o=>{const{name:l,value:j}=o.target;k(g=>({...g,[l]:j})),p[l]&&A(g=>({...g,[l]:""}))},T=()=>{const o={};let l=!0;return a.username.trim()||(o.username="Username is required",l=!1),a.email.trim()?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(a.email)||(o.email="Invalid email address",l=!1):(o.email="Email is required",l=!1),a.newPassword&&(a.currentPassword||(o.currentPassword="Current password is required",l=!1),a.newPassword.length<6?(o.newPassword="New password must be at least 6 characters",l=!1):(!/\d/.test(a.newPassword)||!/[a-zA-Z]/.test(a.newPassword))&&(o.newPassword="Password must contain both letters and numbers",l=!1),a.newPassword!==a.confirmPassword&&(o.confirmPassword="Passwords do not match",l=!1)),A(o),l},C=()=>{D(!1),setTimeout(()=>{c()},300)},S=async o=>{if(o.preventDefault(),a.username===r.username&&a.email===r.email&&!a.newPassword&&!d){b.info("No changes made"),C();return}if(T()){u(!0);try{const l=new FormData;l.append("username",a.username),l.append("email",a.email),a.currentPassword&&l.append("currentPassword",a.currentPassword),a.newPassword&&l.append("newPassword",a.newPassword),d&&l.append("profileImage",d);const j=await fetch(`${w}/users/update-profile`,{method:"PATCH",headers:{Authorization:`Bearer ${m}`},body:l}),g=await j.json();j.ok?(x({type:"UPDATE_USER",payload:{user:g.data}}),b.success("Profile updated successfully"),C()):b.error(g.message||"Failed to update profile")}catch(l){b.error("An error occurred while updating profile"),console.error("Update profile error:",l)}finally{u(!1)}}};return s?e.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300 ${E?"opacity-100":"opacity-0"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl max-w-md w-full p-6 relative transition-transform duration-300 ${E?"scale-100":"scale-95"}`,children:[e.jsx("button",{onClick:C,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",disabled:i,children:"✕"}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Edit Profile"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden mb-3 border-2 border-gray-300",children:e.jsx("img",{src:h||(r==null?void 0:r.photo)||"/user.png",alt:"Profile",className:"w-full h-full object-cover"})}),e.jsx("input",{type:"file",ref:v,accept:"image/*",className:"hidden",onChange:o=>{var j;const l=(j=o.target.files)==null?void 0:j[0];if(l){f(l);const g=new FileReader;g.onloadend=()=>{t(g.result)},g.readAsDataURL(l)}}}),e.jsx("button",{type:"button",onClick:()=>{var o;return(o=v.current)==null?void 0:o.click()},className:"text-blue-600 text-sm hover:underline",disabled:i,children:"Upload Picture"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-slate-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",id:"username",name:"username",value:a.username,onChange:y,disabled:i,className:"w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),p.username&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.username})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:y,disabled:i,className:"w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),p.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.email})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-slate-700 mb-1",children:["Current Password",e.jsx("span",{className:"text-gray-400 ml-2",children:"(only if changing password)"})]}),e.jsx("input",{type:"password",id:"currentPassword",name:"currentPassword",value:a.currentPassword,onChange:y,disabled:i,className:"w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),p.currentPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.currentPassword})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-slate-700 mb-1",children:["New Password",e.jsx("span",{className:"text-gray-400 ml-2",children:"(optional)"})]}),e.jsx("input",{type:"password",id:"newPassword",name:"newPassword",value:a.newPassword,onChange:y,disabled:i,className:"w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),p.newPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.newPassword})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-slate-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:a.confirmPassword,onChange:y,disabled:i,className:"w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),p.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.confirmPassword})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:C,disabled:i,className:"px-4 py-2 mr-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none",children:i?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Changes"})]})]})]})}):null},R=()=>{var u;const{user:s}=n.useContext(N),[c,r]=n.useState(!1),[m,x]=n.useState(!1);n.useEffect(()=>{setTimeout(()=>{x(!0)},100)},[]);const i=h=>h?new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A";return s?e.jsxs("div",{className:"py-8 px-4 md:px-0",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-700 mb-6",children:"My Profile"}),e.jsxs("div",{className:`max-w-lg mx-auto bg-white p-6 rounded-lg shadow transition-all duration-300 ${m?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsxs("div",{className:"mb-6 flex items-center space-x-4",children:[e.jsxs("div",{className:"w-20 h-20 rounded-full border-2 border-solid border-BaseColor flex items-center justify-center overflow-hidden bg-slate-100",children:["            ",s.photo?e.jsx("img",{src:s.photo.startsWith("http")?s.photo:`${w}/${s.photo}`,alt:"Profile",className:"w-full h-full object-cover",onError:h=>{h.target.onerror=null,h.target.src="/user.png"}}):e.jsx("span",{className:"text-2xl text-slate-400",children:((u=s.username)==null?void 0:u.charAt(0).toUpperCase())||"U"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:s.username||s.displayName}),e.jsx("p",{className:"text-slate-600",children:s.email}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["Account type: ",(s==null?void 0:s.authProvider)==="google"?"Google Account":"Email & Password"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"Username"}),e.jsx("p",{className:"text-slate-700",children:s.username||s.displayName})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"Email Address"}),e.jsx("p",{className:"text-slate-700",children:s.email})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"Member Since"}),e.jsx("p",{className:"text-slate-700",children:s!=null&&s.createdAt?i(s.createdAt):"N/A"})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"button",onClick:()=>r(!0),className:"Searchbtn w-full rounded-md py-2.5 text-base font-medium",children:"Edit Profile"})})]}),c&&e.jsx(H,{isOpen:c,onClose:()=>r(!1)})]}):e.jsx("div",{className:"py-8 text-center",children:e.jsx("p",{children:"Loading user profile..."})})},I=()=>{const[s,c]=n.useState([]),[r,m]=n.useState(!0),[x,i]=n.useState(null),{token:u}=n.useContext(N);n.useEffect(()=>{(async()=>{try{const d=await fetch(`${w}/trips/user`,{headers:{Authorization:`Bearer ${u}`}}),f=await d.json();if(!d.ok)throw new Error(f.message||"Failed to fetch trips");c(f.data),m(!1)}catch(d){console.error("Error fetching trips:",d),i(d.message||"Failed to load trips"),m(!1)}})()},[u]);const h=async t=>{if(window.confirm("Are you sure you want to delete this trip?"))try{const d=await fetch(`${w}/trips/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),f=await d.json();if(!d.ok)throw new Error(f.message||"Failed to delete trip");c(v=>v.filter(a=>a._id!==t)),b.success("Trip deleted successfully")}catch(d){b.error(d.message||"Failed to delete trip")}};return r?e.jsx("div",{className:"flex justify-center items-center min-h-[300px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):x?e.jsxs("div",{className:"p-4 bg-red-50 rounded-md text-red-800",children:[e.jsx("p",{children:x}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 underline",children:"Try again"})]}):s.length===0?e.jsxs("div",{className:"text-center py-10 px-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No trips found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You haven't created any trips yet."}),e.jsx(P,{to:"/AiTrip",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Create Your First Trip"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900",children:"Your Generated Trips"}),e.jsx(P,{to:"/AiTrip",className:"text-sm font-medium text-primary hover:underline",children:"Create New Trip"})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:s.map(t=>e.jsx("div",{className:"border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-1",children:t.location}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.budget})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[e.jsx("svg",{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),e.jsxs("span",{children:[t.noOfDays," Days Trip"]})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[e.jsx("svg",{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),e.jsx("span",{children:t.noOfTravellers})]}),e.jsxs("div",{className:"mt-3 flex items-center text-sm text-gray-500",children:[e.jsx("svg",{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),e.jsxs("span",{children:["Created:"," ",new Date(t.createdAt).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[e.jsx(P,{to:`/view-trip/${t._id}`,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"View Details"}),e.jsx("button",{onClick:()=>h(t._id),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Delete"})]})]})},t._id))})]})},G=()=>{const{user:s,dispatch:c,token:r}=n.useContext(N),[m,x]=n.useState("trips"),i=L(),u=async()=>{window.confirm("Are you sure you want to delete your account?")&&h()},h=async()=>{try{const t=await fetch(`${w}/users/${s._id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},credentials:"include"}),{message:d}=await t.json();if(!t.ok){b.error(d);return}try{const f=F();f&&await f.delete()}catch(f){console.error("Could not delete Firebase account:",f)}await U(),await fetch(`${w}/auth/logout`,{method:"POST",credentials:"include"}),c({type:"LOGOUT"}),b.success("Your account has been successfully deleted"),i("/register")}catch{b.error("Server not responding")}};return e.jsx("section",{children:e.jsx("div",{className:"max-w-[1170px] py-4 px-5 mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-10",children:[e.jsxs("div",{className:"py-[50px] px-[30px] rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-center",children:["              ",e.jsx("figure",{className:"w-[100px] h-[100px] rounded-full border-2 border-solid border-Color overflow-hidden",children:e.jsx("img",{src:s.photo||B,alt:s.username,className:"w-full h-full rounded-full object-cover",onError:t=>{t.target.onerror=null,t.target.src=V}})})]}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h3",{className:"text-[18px] leading-[30px] text-HeadingColor font-bold",children:s.username}),e.jsx("p",{className:"text-TextColor text-[15px] leading-6 font-medium",children:s.email})]}),e.jsxs("div",{className:"mt-[50px] md:mt-[70px]",children:[e.jsx("button",{onClick:()=>x("settings"),className:"w-full mb-2 btn",children:"Update Profile"}),e.jsx("button",{onClick:u,className:"w-full bg-black noCbtn hover:bg-gray-900 ",children:"Delete Account"})]})]}),e.jsxs("div",{className:"col-span-2 md:px-[30px]",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-5",children:[e.jsx("button",{onClick:()=>x("trips"),className:`${m==="trips"&&"bg-GrayColor text-white font-bold"} p-2 px-3 lg:px-5 rounded-md text-HeadingColor font-semibold text-[13px] md:text-[14px] lg:text-[16px] leading-7 border border-solid border-Color`,children:"My Trips"}),e.jsx("button",{onClick:()=>x("bookings"),className:`${m==="bookings"&&"bg-GrayColor text-white font-bold"} p-2 px-3 lg:px-5 rounded-md text-HeadingColor font-semibold text-[13px] md:text-[14px] lg:text-[16px] leading-7 border border-solid border-Color`,children:"My Bookings"}),e.jsx("button",{onClick:()=>x("settings"),className:`${m==="settings"&&"bg-GrayColor text-white font-bold"} p-2 px-3 lg:px-5 rounded-md text-HeadingColor font-semibold text-[13px] md:text-[14px] lg:text-[16px] leading-7 border border-solid border-Color`,children:"Profile Settings"})]}),m==="trips"&&e.jsx(I,{}),m==="bookings"&&e.jsx(M,{}),m==="settings"&&e.jsx(R,{user:s,dispatch:c,token:r})]})]})})})};export{G as default};
