import{e as x,a as j,r as i,A as C,j as s,Q as l,B as S}from"./index-007Z5DPj.js";import{C as b,R as y,a as P,F as N,b as m,B as _,S as v}from"./Spinner-DOGx46iQ.js";import"./index-BQquCaqX.js";const A=()=>{const{token:p}=x(),w=j(),{dispatch:h}=i.useContext(C),[e,g]=i.useState({password:"",passwordConfirm:""}),[o,t]=i.useState(!1),[c,n]=i.useState(null),u=d=>{g(a=>({...a,[d.target.id]:d.target.value}))},f=async d=>{if(d.preventDefault(),t(!0),n(null),e.password!==e.passwordConfirm){n("Passwords do not match."),t(!1),l.error("Passwords do not match.");return}if(e.password.length<6){n("Password must be at least 6 characters long."),t(!1),l.error("Password must be at least 6 characters long.");return}try{const a=await fetch(`${S}/auth/reset-password/${p}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e.password,passwordConfirm:e.passwordConfirm})}),r=await a.json();if(!a.ok)throw new Error(r.message||"Failed to reset password.");h({type:"LOGIN_SUCCESS",payload:{user:r.data,token:r.token}}),localStorage.setItem("user",JSON.stringify(r.data)),localStorage.setItem("token",r.token),l.success(r.message||"Password reset successfully! You are now logged in."),t(!1),w("/home")}catch(a){n(a.message),l.error(a.message||"An error occurred."),t(!1)}};return s.jsx("section",{children:s.jsx(b,{children:s.jsx(y,{children:s.jsx(P,{lg:"8",className:"m-auto",children:s.jsxs("div",{className:"login__container d-flex justify-content-between",children:[s.jsxs("div",{className:"login__form",children:[s.jsx("h2",{children:"Reset Your Password"}),s.jsxs(N,{onSubmit:f,children:[s.jsx(m,{children:s.jsx("input",{type:"password",placeholder:"New Password",required:!0,id:"password",value:e.password,onChange:u,disabled:o})}),s.jsx(m,{children:s.jsx("input",{type:"password",placeholder:"Confirm New Password",required:!0,id:"passwordConfirm",value:e.passwordConfirm,onChange:u,disabled:o})}),s.jsx(_,{className:"btn secondary__btn auth__btn",type:"submit",disabled:o,children:o?s.jsx(v,{size:"sm"}):"Reset Password"})]}),c&&s.jsx("p",{className:"text-danger mt-3",children:c})]}),s.jsxs("div",{className:"login__img",children:[s.jsx("img",{src:"/login.png",alt:"Reset Password Visual"})," "]})]})})})})})};export{A as default};
